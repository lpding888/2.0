# AIæ‘„å½±å¸ˆå°ç¨‹åº - å®˜æ–¹æ–‡æ¡£æ¶æ„éªŒè¯

## ğŸ“‹ éªŒè¯æ¸…å•

åŸºäºè…¾è®¯äº‘SCFå®˜æ–¹æ–‡æ¡£çš„æ¶æ„è®¾è®¡å’Œå®ç°éªŒè¯ï¼š

### âœ… 1. Function URLé…ç½®éªŒè¯

**å®˜æ–¹æ–‡æ¡£è¦æ±‚ï¼š**
- âœ… ä½¿ç”¨ `type: web` é…ç½®Webå‡½æ•°ç±»å‹
- âœ… è‡ªåŠ¨å¯ç”¨Function URLï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®è§¦å‘å™¨
- âœ… å‡½æ•°å…¥å£ä½¿ç”¨ `exports.main_handler` æ ¼å¼
- âœ… æ”¯æŒç›´æ¥HTTPè¯·æ±‚é€ä¼ 

**å®ç°éªŒè¯ï¼š**
```yaml
# serverless-official.yml
functions:
  api-gateway:
    handler: api-gateway.main_handler
    type: web  # âœ… æ­£ç¡®çš„Webå‡½æ•°ç±»å‹
```

```javascript
// api-gateway-official.js
exports.main_handler = async (event, context) => {
  // âœ… æ­£ç¡®çš„SCFå…¥å£æ ¼å¼
  return {
    statusCode: 200,
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(response)
  }
}
```

### âœ… 2. è¯·æ±‚å“åº”æ ¼å¼éªŒè¯

**å®˜æ–¹æ–‡æ¡£è§„èŒƒï¼š**
- âœ… Webå‡½æ•°ç›´æ¥æ¥æ”¶HTTPè¯·æ±‚å‚æ•°
- âœ… æ ‡å‡†HTTPå“åº”æ ¼å¼
- âœ… æ­£ç¡®å¤„ç†CORS

**å®ç°éªŒè¯ï¼š**
```javascript
// âœ… æ­£ç¡®çš„è¯·æ±‚å¤„ç†
const { path, httpMethod, headers, body } = event

// âœ… æ­£ç¡®çš„å“åº”æ ¼å¼
return {
  statusCode: 200,
  headers: {
    'Content-Type': 'application/json',
    'Access-Control-Allow-Origin': '*'
  },
  body: JSON.stringify({
    success: true,
    data: result
  })
}
```

### âœ… 3. å‡½æ•°é—´è°ƒç”¨éªŒè¯

**å®˜æ–¹æ–‡æ¡£è§„èŒƒï¼š**
- âœ… ä½¿ç”¨Invoke APIè¿›è¡Œå‡½æ•°é—´è°ƒç”¨
- âœ… æ”¯æŒåŒæ­¥è°ƒç”¨ï¼ˆRequestResponseï¼‰
- âœ… æ­£ç¡®çš„Payloadæ ¼å¼

**å®ç°éªŒè¯ï¼š**
```javascript
// âœ… æ­£ç¡®çš„å‡½æ•°è°ƒç”¨æ–¹å¼
const scf = require('@tencentcloud/scf-sdk')

const result = await scf.invoke({
  FunctionName: 'photography-service',
  InvocationType: 'RequestResponse', // âœ… åŒæ­¥è°ƒç”¨
  Payload: JSON.stringify(payload)
})
```

### âœ… 4. ç¯å¢ƒå˜é‡é…ç½®éªŒè¯

**å®˜æ–¹æ–‡æ¡£è§„èŒƒï¼š**
- âœ… ä½¿ç”¨ `${env:VAR_NAME}` æ ¼å¼å¼•ç”¨ç¯å¢ƒå˜é‡
- âœ… æ”¯æŒé»˜è®¤å€¼è®¾ç½®
- âœ… å‡½æ•°çº§åˆ«çš„ç¯å¢ƒå˜é‡

**å®ç°éªŒè¯ï¼š**
```yaml
# âœ… æ­£ç¡®çš„ç¯å¢ƒå˜é‡é…ç½®
environment:
  NODE_ENV: production
  MONGODB_URI: ${env:MONGODB_URI}
  BUSINESS_MODE: ${env:BUSINESS_MODE, 'hybrid'}
```

### âœ… 5. æ‰“åŒ…é…ç½®éªŒè¯

**å®˜æ–¹æ–‡æ¡£è§„èŒƒï¼š**
- âœ… ä½¿ç”¨ `individually: true` ç‹¬ç«‹æ‰“åŒ…
- âœ… æ­£ç¡®çš„excludeé…ç½®
- âœ… é¿å…æ‰“åŒ…ä¸å¿…è¦çš„æ–‡ä»¶

**å®ç°éªŒè¯ï¼š**
```yaml
# âœ… æ­£ç¡®çš„æ‰“åŒ…é…ç½®
package:
  individually: true
  exclude:
    - .git/**
    - node_modules/**
    - README.md
    - .env*
```

## ğŸ” æ ¸å¿ƒæ¶æ„å†³ç­–éªŒè¯

### 1. ä¿æŒåŸé¡¹ç›®è®¾è®¡ç†å¿µ

**åŸé¡¹ç›®ä¼˜åŠ¿ï¼š**
- âœ… Actionè·¯ç”±æ¨¡å¼å®Œå…¨ä¿ç•™
- âœ… ç»Ÿä¸€å…¥å£è®¾è®¡ä¿æŒ
- âœ… ç®€æ´çš„è°ƒç”¨æ–¹å¼ä¸å˜

**SCFé€‚é…ï¼š**
- âœ… `wx.cloud.callFunction` â†’ `HTTPè¯·æ±‚ + Actionè·¯ç”±`
- âœ… äº‘å‡½æ•°è‡ªåŠ¨è·¯ç”± â†’ `api-gateway`æ™ºèƒ½è·¯ç”±
- âœ… ç›´æ¥å‡½æ•°è°ƒç”¨ â†’ `Invoke API`è°ƒç”¨

### 2. å……åˆ†åˆ©ç”¨SCFä¼˜åŠ¿

**æ€§èƒ½ä¼˜åŠ¿ï¼š**
- âœ… å†…å­˜ï¼š128MB â†’ 2GBï¼ˆæ‘„å½±æœåŠ¡ï¼‰
- âœ… è¶…æ—¶ï¼šå‡½æ•°çº§åˆ«é…ç½®ï¼ˆæœ€é•¿15åˆ†é’Ÿï¼‰
- âœ… å¹¶å‘ï¼šæ— å•å®ä¾‹é™åˆ¶

**æˆæœ¬ä¼˜åŠ¿ï¼š**
- âœ… æŒ‰å®é™…ä½¿ç”¨ä»˜è´¹
- âœ… æ— APIç½‘å…³è´¹ç”¨
- âœ… æ— é—²ç½®æœåŠ¡å™¨æˆæœ¬

### 3. æœ€å°åŒ–å‡½æ•°é—´è°ƒç”¨

**è®¾è®¡åŸåˆ™ï¼š**
- âœ… ç®€å•æ“ä½œç›´æ¥åœ¨api-gatewayå¤„ç†
- âœ… å¤æ‚ä¸šåŠ¡æ‰è°ƒç”¨ä¸“é—¨æœåŠ¡
- âœ… æ•°æ®æŸ¥è¯¢æ“ä½œæœ¬åœ°åŒ–å¤„ç†

**å®ç°ç­–ç•¥ï¼š**
```javascript
// âœ… ç›´æ¥å¤„ç†ï¼ˆæ— å‡½æ•°è°ƒç”¨å¼€é”€ï¼‰
case 'user.getInfo':
case 'scene.list':
case 'storage.getUploadUrl':
  return await handleDirectly(data, openid)

// âœ… è°ƒç”¨ä¸“é—¨æœåŠ¡ï¼ˆå¤æ‚ä¸šåŠ¡ï¼‰
case 'photography.generate':
case 'fitting.generate':
  return await callSpecializedService(action, data, openid)
```

## ğŸš€ éƒ¨ç½²éªŒè¯æ­¥éª¤

### 1. ç¯å¢ƒå‡†å¤‡éªŒè¯
```bash
# âœ… æ£€æŸ¥Serverless Frameworkç‰ˆæœ¬
npx serverless --version
# åº”è¯¥æ˜¯ Framework Core: 3.x.x

# âœ… æ£€æŸ¥è…¾è®¯äº‘å‡­è¯
cat ~/.tencentcloud/credentials.ini
```

### 2. é…ç½®æ–‡ä»¶éªŒè¯
```bash
# âœ… éªŒè¯YAMLè¯­æ³•
npx serverless config validate --config serverless-official.yml

# âœ… æ£€æŸ¥å‡½æ•°é…ç½®
npx serverless info --config serverless-official.yml
```

### 3. éƒ¨ç½²æµ‹è¯•éªŒè¯
```bash
# âœ… éƒ¨ç½²åˆ°è…¾è®¯äº‘
npx serverless deploy --config serverless-official.yml

# âœ… éªŒè¯Function URL
curl -X GET "https://your-api-gateway-url.scf.tencentcloudapi.com"

# âœ… æµ‹è¯•Actionè·¯ç”±
curl -X POST "https://your-api-gateway-url.scf.tencentcloudapi.com" \
  -H "Content-Type: application/json" \
  -d '{"action":"user.getInfo","openid":"test123"}'
```

## ğŸ“Š é¢„æœŸéƒ¨ç½²ç»“æœ

### Function URLåœ°å€ç¤ºä¾‹ï¼š
```
APIç½‘å…³:        https://service-xxxxxxx.gz.scf.tencentcloudapi.com
æ‘„å½±æœåŠ¡:       https://service-xxxxxxx.gz.scf.tencentcloudapi.com
è¯•è¡£æœåŠ¡:       https://service-xxxxxxx.gz.scf.tencentcloudapi.com
ç”¨æˆ·æœåŠ¡:       https://service-xxxxxxx.gz.scf.tencentcloudapi.com
å­˜å‚¨æœåŠ¡:       https://service-xxxxxxx.gz.scf.tencentcloudapi.com
æ•°æ®æœåŠ¡:       https://service-xxxxxxx.gz.scf.tencentcloudapi.com
```

### å¥åº·æ£€æŸ¥å“åº”ï¼š
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "timestamp": "2025-10-21T10:00:00.000Z",
    "service": "ai-photography-api-gateway",
    "version": "2.0.0",
    "architecture": "scf-function-url-official"
  }
}
```

## ğŸ¯ å…³é”®ä¼˜åŠ¿æ€»ç»“

### ç›¸æ¯”åŸå¾®ä¿¡äº‘å¼€å‘ï¼š
1. **âœ… æ›´é«˜æ€§èƒ½** - 2GBå†…å­˜ï¼Œ15åˆ†é’Ÿè¶…æ—¶
2. **âœ… æ›´å¼ºå¹¶å‘** - æ— å•å®ä¾‹é™åˆ¶
3. **âœ… æ›´ä½æˆæœ¬** - æŒ‰å®é™…ä½¿ç”¨ä»˜è´¹
4. **âœ… æ›´å¥½æ‰©å±•** - å¯ç‹¬ç«‹æ‰©å±•æ¯ä¸ªæœåŠ¡

### ç›¸æ¯”è¿‡åº¦æ‹†åˆ†æ¶æ„ï¼š
1. **âœ… æ›´ä½å»¶è¿Ÿ** - å‡å°‘ä¸å¿…è¦çš„å‡½æ•°é—´è°ƒç”¨
2. **âœ… æ›´ç®€å•éƒ¨ç½²** - ç›¸å…³åŠŸèƒ½èšåˆ
3. **âœ… æ›´å¥½ç»´æŠ¤** - åŠŸèƒ½é›†ä¸­ï¼Œè°ƒè¯•å®¹æ˜“
4. **âœ… æ›´å°‘æˆæœ¬** - å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€

## ğŸ“ éƒ¨ç½²å‰æœ€ç»ˆæ£€æŸ¥

- [ ] Serverless Framework V3.x.x å·²å®‰è£…
- [ ] è…¾è®¯äº‘å‡­è¯é…ç½®æ­£ç¡®
- [ ] ç¯å¢ƒå˜é‡é…ç½®å®Œæ•´
- [ ] ä»£ç ä½¿ç”¨ `exports.main_handler` å…¥å£
- [ ] é…ç½®æ–‡ä»¶ä½¿ç”¨ `type: web`
- [ ] æ‰€æœ‰å‡½æ•°æ–‡ä»¶å·²åˆ›å»º
- [ ] ä¾èµ–åŒ…å·²å®‰è£…ï¼ˆnpm installå®Œæˆï¼‰

**âœ¨ åŸºäºå®˜æ–¹æ–‡æ¡£çš„æ¶æ„å·²å®Œæˆï¼Œå¯ä»¥å®‰å…¨éƒ¨ç½²ï¼**