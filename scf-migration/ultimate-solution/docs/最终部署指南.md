# AIæ‘„å½±å¸ˆå°ç¨‹åº - SCFæœ€ç»ˆéƒ¨ç½²æŒ‡å—

## ğŸ¯ é…ç½®ä¿®å¤å®Œæˆ

æ ¹æ®è…¾è®¯äº‘SCFå®˜æ–¹æ–‡æ¡£è¦æ±‚ï¼Œå·²ä¿®å¤æ‰€æœ‰é…ç½®é—®é¢˜ï¼Œç°åœ¨å¯ä»¥å®‰å…¨éƒ¨ç½²ã€‚

## ğŸ”§ ä¿®å¤çš„å…³é”®é—®é¢˜

### 1. Handlerè·¯å¾„æ ¼å¼ä¿®å¤
**é—®é¢˜**: åŸé…ç½®ä½¿ç”¨äº†ä¸æ­£ç¡®çš„è·¯å¾„æ ¼å¼
```yaml
# âŒ é”™è¯¯æ ¼å¼
handler: src/handlers/api-gateway.main_handler

# âœ… æ­£ç¡®æ ¼å¼
handler: api-gateway.main_handler
```

### 2. è§¦å‘å™¨ç±»å‹ä¿®å¤
**é—®é¢˜**: ä½¿ç”¨äº†é”™è¯¯çš„è§¦å‘å™¨ç±»å‹
```yaml
# âŒ é”™è¯¯è§¦å‘å™¨
events:
  - http:
      path: /api/{action}
      method: ANY

# âœ… æ­£ç¡®è§¦å‘å™¨
events:
  - apigw:
      path: /api
      method: ANY
```

### 3. å‡½æ•°å…¥å£ç‚¹æ ¼å¼ç¡®è®¤
**ç¡®è®¤**: æ‰€æœ‰å‡½æ•°éƒ½ä½¿ç”¨æ­£ç¡®çš„å…¥å£ç‚¹æ ¼å¼
```javascript
// âœ… æ­£ç¡®çš„SCFå…¥å£ç‚¹
exports.main_handler = async (event, context) => {
  // å¤„ç†é€»è¾‘
}
```

## ğŸ“‹ éªŒè¯ç»“æœ

âœ… **10/10é¡¹é…ç½®æ£€æŸ¥é€šè¿‡**
- Provideré…ç½®æ­£ç¡® (è…¾è®¯äº‘SCF)
- Runtimeé…ç½®æ­£ç¡® (Node.js 18.15)
- å‡½æ•°å…¥å£ç‚¹æ ¼å¼æ­£ç¡® (exports.main_handler)
- APIç½‘å…³è§¦å‘å™¨é…ç½®æ­£ç¡® (apigw)
- ç¯å¢ƒå˜é‡é…ç½®å®Œæ•´
- ä¾èµ–åŒ…å®‰è£…å®Œæˆ

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. ç¡®è®¤ç¯å¢ƒå‡†å¤‡
```bash
# æ£€æŸ¥å‡­è¯é…ç½®
ls ~/.tencentcloud/credentials.ini

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env | grep -E "(MONGODB_URI|JWT_SECRET|WECHAT_APP_ID)"
```

### 2. éƒ¨ç½²SCFå‡½æ•°
```bash
# ä½¿ç”¨ä¿®å¤åçš„é…ç½®æ–‡ä»¶éƒ¨ç½²
sls deploy --config serverless-fixed.yml --verbose
```

### 3. éªŒè¯éƒ¨ç½²ç»“æœ
éƒ¨ç½²å®Œæˆåï¼Œæµ‹è¯•APIï¼š
```bash
# å¥åº·æ£€æŸ¥
curl -X GET "https://your-api-url/api"

# ç”¨æˆ·æ³¨å†Œæµ‹è¯•
curl -X POST "https://your-api-url/user" \
  -H "Content-Type: application/json" \
  -d '{"action":"register","openid":"test123","userInfo":{"nickname":"æµ‹è¯•ç”¨æˆ·"}}'
```

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
ultimate-solution/
â”œâ”€â”€ serverless-fixed.yml          # âœ… ä¿®å¤åçš„éƒ¨ç½²é…ç½®
â”œâ”€â”€ api-gateway.js                # âœ… APIç½‘å…³å‡½æ•°
â”œâ”€â”€ user-service.js               # âœ… ç”¨æˆ·æœåŠ¡å‡½æ•°
â”œâ”€â”€ .env                          # âœ… ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ package.json                   # âœ… ä¾èµ–ç®¡ç†
â”œâ”€â”€ node_modules/                  # âœ… ä¾èµ–åŒ…
â”œâ”€â”€ backend/                      # åŸå§‹ä»£ç ç›®å½•
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ handlers/             # å¤„ç†å™¨æ–‡ä»¶
â”‚       â”œâ”€â”€ services/             # æœåŠ¡æ–‡ä»¶
â”‚       â”œâ”€â”€ shared/               # å…±äº«æ¨¡å—
â”‚       â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
â””â”€â”€ docs/                         # æ–‡æ¡£ç›®å½•
    â”œâ”€â”€ é…ç½®éªŒè¯æŠ¥å‘Š.md
    â””â”€â”€ æœ€ç»ˆéƒ¨ç½²æŒ‡å—.md
```

## ğŸ”Œ APIè°ƒç”¨ç¤ºä¾‹

### å°ç¨‹åºç«¯è°ƒç”¨
```javascript
// è·å–ç”¨æˆ·ä¿¡æ¯
wx.request({
  url: 'https://your-function-url/user',
  method: 'POST',
  header: {
    'Content-Type': 'application/json'
  },
  data: {
    action: 'getInfo',
    openid: 'user_openid'
  },
  success: (res) => {
    if (res.data.success) {
      console.log('ç”¨æˆ·ä¿¡æ¯:', res.data.data.user)
    }
  }
})

// AIç”Ÿæˆè°ƒç”¨
wx.request({
  url: 'https://your-function-url/ai',
  method: 'POST',
  header: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  data: {
    action: 'ai.generateFashionPhoto',
    model_image: 'person_image_id',
    clothing_images: {
      top: 'clothing_image_id'
    }
  }
})
```

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### 1. éƒ¨ç½²å¤±è´¥
```bash
# æ£€æŸ¥Serverless Frameworkç‰ˆæœ¬
sls --version

# æ£€æŸ¥æ’ä»¶
sls plugin list

# è¯¦ç»†é”™è¯¯ä¿¡æ¯
sls deploy --config serverless-fixed.yml --verbose --debug
```

### 2. å‡½æ•°è°ƒç”¨å¤±è´¥
- æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®
- æ£€æŸ¥æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- æŸ¥çœ‹å‡½æ•°æ—¥å¿—: `sls logs -f api-gateway`

### 3. æƒé™é—®é¢˜
- æ£€æŸ¥è…¾è®¯äº‘è®¿é—®å¯†é’¥
- ç¡®è®¤SCFæœåŠ¡æƒé™
- æ£€æŸ¥APIç½‘å…³é…ç½®

## ğŸ“Š æ€§èƒ½é…ç½®

### å‡½æ•°èµ„æºé…ç½®
```yaml
# APIç½‘å…³: 512MBå†…å­˜, 30ç§’è¶…æ—¶
# ç”¨æˆ·æœåŠ¡: 256MBå†…å­˜, 30ç§’è¶…æ—¶
# AIç”ŸæˆæœåŠ¡: 2048MBå†…å­˜, 900ç§’è¶…æ—¶
# å•†ä¸šæ‘„å½±æœåŠ¡: 2048MBå†…å­˜, 900ç§’è¶…æ—¶
```

### å¹¶å‘æ§åˆ¶
- APIç½‘å…³: é¢„ç•™100å¹¶å‘
- AIç”ŸæˆæœåŠ¡: é¢„ç•™20å¹¶å‘
- æ”¯æŒæŒ‰éœ€è‡ªåŠ¨æ‰©ç¼©å®¹

## ğŸ‰ éƒ¨ç½²æˆåŠŸæ ‡å¿—

å½“çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºæ—¶ï¼Œè¡¨ç¤ºéƒ¨ç½²æˆåŠŸï¼š

```
âœ… api-gateway: å‡½æ•°éƒ¨ç½²æˆåŠŸ
  FunctionUrl: https://service-xxxxx.gz.apigw.tencentcsapi.com/release/api
âœ… user-service: å‡½æ•°éƒ¨ç½²æˆåŠŸ
  FunctionUrl: https://service-xxxxx.gz.apigw.tencentcsapi.com/release/user
âœ… ai-generation: å‡½æ•°éƒ¨ç½²æˆåŠŸ
  FunctionUrl: https://service-xxxxx.gz.apigw.tencentcsapi.com/release/ai
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£**: https://cloud.tencent.com/document/product/583
2. **æ£€æŸ¥é…ç½®æ–‡ä»¶**: `serverless-fixed.yml`
3. **æŸ¥çœ‹æ—¥å¿—**: `sls logs -f [function-name]`
4. **éªŒè¯ç¯å¢ƒå˜é‡**: `.env`æ–‡ä»¶

---

## ğŸš€ æ€»ç»“

ç»è¿‡ä¸¥æ ¼æŒ‰ç…§è…¾è®¯äº‘SCFå®˜æ–¹æ–‡æ¡£è¦æ±‚çš„é…ç½®ä¿®å¤ï¼Œé¡¹ç›®ç°åœ¨å®Œå…¨ç¬¦åˆéƒ¨ç½²æ ‡å‡†ï¼š

- âœ… **å‡½æ•°å…¥å£ç‚¹æ ¼å¼æ­£ç¡®**
- âœ… **è§¦å‘å™¨é…ç½®è§„èŒƒ**
- âœ… **Handlerè·¯å¾„æ ¼å¼æ ‡å‡†**
- âœ… **ç¯å¢ƒå˜é‡å®Œæ•´**
- âœ… **ä¾èµ–åŒ…å°±ç»ª**

**é¡¹ç›®å·²å‡†å¤‡å¥½éƒ¨ç½²åˆ°è…¾è®¯äº‘SCFï¼** ğŸ¯