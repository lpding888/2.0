# 🚀 姿势裂变功能 - 快速部署脚本

## 方法1：云开发控制台直接导入数据

### 步骤1：创建集合
1. 打开微信开发者工具 → 云开发 → 数据库
2. 点击"添加集合" → 输入 `pose_presets` → 确定

### 步骤2：批量导入数据
1. 在 `pose_presets` 集合中，点击"导入"
2. 选择下面的JSON文件内容，保存为 `pose_presets.json`
3. 点击"选择文件" → 选择 `pose_presets.json` → 确定导入

**pose_presets.json 文件内容：**

```json
[
  {
    "_id": "pose_001",
    "name": "标准站姿",
    "description": "直立站姿，双手自然下垂，展示服装正面",
    "prompt": "模特保持直立站姿，双手自然下垂或轻放身侧，面向镜头，微笑自然，展示服装的正面完整效果",
    "category": "standing",
    "sort_order": 1,
    "is_active": true,
    "icon_emoji": "👤"
  },
  {
    "_id": "pose_002",
    "name": "S型曲线",
    "description": "重心偏移，展现优雅曲线",
    "prompt": "模特一腿微曲，重心偏向一侧，形成优雅的S型身体曲线，一只手轻放腰部或头发，展现服装的动态美感",
    "category": "dynamic",
    "sort_order": 2,
    "is_active": true,
    "icon_emoji": "💃"
  },
  {
    "_id": "pose_003",
    "name": "优雅坐姿",
    "description": "坐姿展示，轻松优雅",
    "prompt": "模特优雅地坐在简约的白色方凳上，双腿自然交叠或并拢，手部姿态优雅自然，展现服装的休闲质感",
    "category": "sitting",
    "sort_order": 3,
    "is_active": true,
    "icon_emoji": "🪑"
  },
  {
    "_id": "pose_004",
    "name": "45度侧身",
    "description": "侧身展示服装轮廓",
    "prompt": "模特身体转向45度角，脸部看向镜头，一只手轻搭腰部，展示服装的侧面轮廓和立体剪裁",
    "category": "side",
    "sort_order": 4,
    "is_active": true,
    "icon_emoji": "↗️"
  },
  {
    "_id": "pose_005",
    "name": "回眸展示",
    "description": "背面展示，优雅回眸",
    "prompt": "模特背对镜头，优雅地回头看向相机，展示服装的背面设计细节和整体效果",
    "category": "back",
    "sort_order": 5,
    "is_active": true,
    "icon_emoji": "👀"
  },
  {
    "_id": "pose_006",
    "name": "行走动态",
    "description": "自然行走的瞬间",
    "prompt": "模特做出自然行走的动作，一腿向前迈步，展现服装的动态流动感和穿着效果",
    "category": "walking",
    "sort_order": 6,
    "is_active": true,
    "icon_emoji": "🚶"
  },
  {
    "_id": "pose_007",
    "name": "双手叉腰",
    "description": "自信力量感姿势",
    "prompt": "模特双脚分开与肩同宽，双手叉腰，展现自信和力量感，适合展示职业装和外套",
    "category": "power",
    "sort_order": 7,
    "is_active": true,
    "icon_emoji": "💪"
  },
  {
    "_id": "pose_008",
    "name": "手托下巴",
    "description": "优雅思考姿势",
    "prompt": "模特一只手轻托下巴，呈现思考或优雅的姿态，展现服装的精致感和细节",
    "category": "elegant",
    "sort_order": 8,
    "is_active": true,
    "icon_emoji": "🤔"
  }
]
```

---

## 方法2：使用初始化脚本

如果云开发控制台导入失败，可以使用初始化脚本：

### 步骤1：创建临时云函数
1. 在 `cloudfunctions` 目录中创建新文件夹 `init-poses`
2. 在 `init-poses` 文件夹中创建 `index.js`：

```javascript
const cloud = require('wx-server-sdk')
cloud.init({ env: cloud.DYNAMIC_CURRENT_ENV })
const db = cloud.database()

exports.main = async (event, context) => {
  const poses = [
    {
      _id: 'pose_001',
      name: '标准站姿',
      description: '直立站姿，双手自然下垂，展示服装正面',
      prompt: '模特保持直立站姿，双手自然下垂或轻放身侧，面向镜头，微笑自然，展示服装的正面完整效果',
      category: 'standing',
      sort_order: 1,
      is_active: true,
      icon_emoji: '👤',
      created_at: new Date(),
      updated_at: new Date()
    },
    {
      _id: 'pose_002',
      name: 'S型曲线',
      description: '重心偏移，展现优雅曲线',
      prompt: '模特一腿微曲，重心偏向一侧，形成优雅的S型身体曲线，一只手轻放腰部或头发，展现服装的动态美感',
      category: 'dynamic',
      sort_order: 2,
      is_active: true,
      icon_emoji: '💃',
      created_at: new Date(),
      updated_at: new Date()
    },
    {
      _id: 'pose_003',
      name: '优雅坐姿',
      description: '坐姿展示，轻松优雅',
      prompt: '模特优雅地坐在简约的白色方凳上，双腿自然交叠或并拢，手部姿态优雅自然，展现服装的休闲质感',
      category: 'sitting',
      sort_order: 3,
      is_active: true,
      icon_emoji: '🪑',
      created_at: new Date(),
      updated_at: new Date()
    },
    {
      _id: 'pose_004',
      name: '45度侧身',
      description: '侧身展示服装轮廓',
      prompt: '模特身体转向45度角，脸部看向镜头，一只手轻搭腰部，展示服装的侧面轮廓和立体剪裁',
      category: 'side',
      sort_order: 4,
      is_active: true,
      icon_emoji: '↗️',
      created_at: new Date(),
      updated_at: new Date()
    },
    {
      _id: 'pose_005',
      name: '回眸展示',
      description: '背面展示，优雅回眸',
      prompt: '模特背对镜头，优雅地回头看向相机，展示服装的背面设计细节和整体效果',
      category: 'back',
      sort_order: 5,
      is_active: true,
      icon_emoji: '👀',
      created_at: new Date(),
      updated_at: new Date()
    },
    {
      _id: 'pose_006',
      name: '行走动态',
      description: '自然行走的瞬间',
      prompt: '模特做出自然行走的动作，一腿向前迈步，展现服装的动态流动感和穿着效果',
      category: 'walking',
      sort_order: 6,
      is_active: true,
      icon_emoji: '🚶',
      created_at: new Date(),
      updated_at: new Date()
    },
    {
      _id: 'pose_007',
      name: '双手叉腰',
      description: '自信力量感姿势',
      prompt: '模特双脚分开与肩同宽，双手叉腰，展现自信和力量感，适合展示职业装和外套',
      category: 'power',
      sort_order: 7,
      is_active: true,
      icon_emoji: '💪',
      created_at: new Date(),
      updated_at: new Date()
    },
    {
      _id: 'pose_008',
      name: '手托下巴',
      description: '优雅思考姿势',
      prompt: '模特一只手轻托下巴，呈现思考或优雅的姿态，展现服装的精致感和细节',
      category: 'elegant',
      sort_order: 8,
      is_active: true,
      icon_emoji: '🤔',
      created_at: new Date(),
      updated_at: new Date()
    }
  ]

  try {
    // 检查是否已有数据
    const count = await db.collection('pose_presets').count()
    if (count.total > 0) {
      return {
        success: false,
        message: `集合已有${count.total}条数据，跳过初始化`
      }
    }

    // 批量添加
    const tasks = poses.map(pose =>
      db.collection('pose_presets').add({ data: pose })
    )
    await Promise.all(tasks)

    return {
      success: true,
      message: `成功初始化${poses.length}个姿势预设`
    }
  } catch (error) {
    return {
      success: false,
      message: error.message
    }
  }
}
```

3. 创建 `package.json`：

```json
{
  "name": "init-poses",
  "version": "1.0.0",
  "description": "初始化姿势预设",
  "main": "index.js",
  "dependencies": {
    "wx-server-sdk": "~2.6.3"
  }
}
```

### 步骤2：部署并执行
1. 右键点击 `init-poses` → 上传并部署：云端安装依赖
2. 部署完成后，右键点击 `init-poses` → 云端测试
3. 执行成功会显示：`成功初始化8个姿势预设`
4. 执行完成后可以删除 `init-poses` 云函数

---

## 验证部署成功

### 检查1：云函数列表
云开发 → 云函数，应显示：
- ✅ photography（绿色正常）
- ✅ photography-worker（绿色正常）
- ✅ fitting（绿色正常）
- ✅ fitting-worker（绿色正常）
- ✅ prompt（绿色正常）

### 检查2：数据库
云开发 → 数据库 → pose_presets，应有8条记录

### 检查3：前端测试
1. 打开小程序
2. 进入"我的作品"
3. 点击任意已完成的作品
4. 应看到【姿势裂变】按钮
5. 点击后能看到8个姿势选项

部署完成！🎉
