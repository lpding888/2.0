# AI摄影师小程序 - 部署前检查清单

## 🚀 部署准备

### 1. 环境要求
- [x] 微信开发者工具已安装
- [x] Node.js 环境 (v16+)
- [x] 云开发环境已创建

### 2. 项目文件检查
- [x] 所有云函数已清理模拟数据
- [x] database-init.js 已清理（仅保留结构）
- [x] 管理中心页面已完成
- [x] API接口已修复

### 3. 云函数列表确认
请确保以下云函数都存在并已清理：

#### 核心云函数
- [x] `api` - 通用API接口
- [x] `user` - 用户管理
- [x] `photography` - 摄影功能
- [x] `fitting` - 试衣功能
- [x] `payment` - 支付功能

#### 管理云函数
- [x] `prompt` - 提示词管理（新增）
- [x] `aimodels` - AI模型管理（新增）
- [x] `scene` - 场景管理（扩展）
- [x] `storage` - 存储管理

### 4. 数据库准备
- [ ] 手动添加管理员用户到 `admin_users` 集合
- [ ] 配置环境变量 `ADMIN_USERS`
- [ ] 设置云存储权限

### 5. 配置检查
- [ ] 小程序AppID已配置
- [ ] 云开发环境ID已设置
- [ ] 支付配置（如需要）
- [ ] AI服务API密钥（部署后配置）

## 📋 部署步骤

### 第一步：部署云函数
```powershell
# 在项目根目录执行
.\deploy-cloudfunctions.ps1
```

### 第二步：初始化数据库
在微信开发者工具的云开发控制台中：
1. 打开数据库页面
2. 点击"创建集合"，或通过云函数创建
3. 运行 `database-init.js` 脚本

### 第三步：配置管理员权限
1. 在 `admin_users` 集合中添加管理员记录：
```json
{
  "openid": "你的微信openid",
  "nickname": "管理员名称",
  "is_active": true,
  "permissions": ["admin"],
  "created_at": "当前时间"
}
```

2. 或设置环境变量：
   - 变量名：`ADMIN_USERS`
   - 变量值：`openid1,openid2,openid3`

### 第四步：配置云存储
1. 设置云存储安全规则
2. 创建必要的文件夹结构
3. 配置图片处理权限

### 第五步：测试验证
1. 测试用户注册登录
2. 测试管理中心访问（连续点击头像10次）
3. 测试AI模型添加功能
4. 测试提示词管理功能
5. 测试场景管理功能

## ⚠️ 注意事项

### 数据安全
- 所有模拟数据已清理
- 管理员权限需手动配置
- API密钥需部署后单独配置

### 管理中心访问
- 隐藏入口：个人中心页面连续点击头像10次
- 需要管理员权限验证
- 普通用户无法发现或访问

### API配置
- AI模型的API密钥需要在管理中心中配置
- 不要在代码中硬编码真实的API密钥
- 建议使用环境变量管理敏感信息

## 🔍 部署后检查

### 功能测试
- [ ] 用户注册登录正常
- [ ] 摄影功能可用
- [ ] 试衣功能可用
- [ ] 支付功能正常（如启用）
- [ ] 管理中心可访问
- [ ] AI模型管理正常
- [ ] 提示词管理正常
- [ ] 场景管理正常

### 性能检查
- [ ] 云函数响应时间正常
- [ ] 数据库查询性能良好
- [ ] 图片上传速度合理
- [ ] 内存使用在合理范围

### 安全检查
- [ ] 管理员权限验证生效
- [ ] 普通用户无法访问管理功能
- [ ] API调用有适当的权限控制
- [ ] 敏感数据未暴露

## 📞 技术支持

如果在部署过程中遇到问题：

1. 检查微信开发者工具控制台错误信息
2. 查看云函数日志
3. 确认数据库权限设置
4. 验证环境变量配置

## 🎉 部署完成

部署成功后，您的AI摄影师小程序将具备：

- 完整的多模态AI支持
- 统一的后台管理系统
- 安全的权限控制机制
- 灵活的配置管理功能

祝您使用愉快！🎊