<!--æˆ‘çš„è¡£æŸœé¡µé¢ - äººæ€§åŒ–å¢å¼ºç‰ˆ-->
<view class="container page-slide-up">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ğŸ‘” æˆ‘çš„è¡£æŸœ</text>
    <text class="page-subtitle">æ™ºèƒ½ç®¡ç†ä½ çš„æœè£…æ”¶è—</text>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        placeholder="æœç´¢æœè£…åç§°ã€é¢œè‰²..."
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
      <text wx:if="{{searchKeyword}}" class="clear-icon" bindtap="clearSearch">Ã—</text>
    </view>
  </view>

  <!-- è§†å›¾æ¨¡å¼åˆ‡æ¢ -->
  <view class="view-mode-tabs">
    <view
      class="mode-tab {{viewMode === 'clothing' ? 'active' : ''}}"
      bindtap="switchViewMode"
      data-mode="clothing"
    >
      <text>ğŸ‘• å•å“</text>
    </view>
    <view
      class="mode-tab {{viewMode === 'outfit' ? 'active' : ''}}"
      bindtap="switchViewMode"
      data-mode="outfit"
    >
      <text>ğŸ‘” å¥—è£…</text>
    </view>
  </view>

  <!-- æœè£…è§†å›¾ -->
  <block wx:if="{{viewMode === 'clothing'}}">
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{clothingList.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ‘”</text>
      <text class="empty-text">è¡£æŸœç©ºç©ºå¦‚ä¹Ÿ</text>
      <text class="empty-hint">æ·»åŠ æœè£…å›¾ç‰‡åˆ°ä½ çš„ä¸“å±è¡£æŸœå§</text>
      <button class="add-btn" bindtap="addClothing">
        <text class="btn-icon">â•</text>
        <text>æ·»åŠ æœè£…</text>
      </button>
    </view>

    <!-- æœè£…åˆ—è¡¨ -->
    <view wx:else class="content-area">
      <!-- ç­›é€‰æ  -->
      <view class="filter-section">
        <!-- åˆ†ç±»ç­›é€‰ -->
        <view class="filter-row">
          <text class="filter-label">åˆ†ç±»</text>
          <scroll-view class="filter-scroll" scroll-x>
            <view class="filter-tabs">
              <block wx:for="{{categories}}" wx:key="key">
                <view
                  class="filter-tab {{currentCategory === item.key ? 'active' : ''}}"
                  bindtap="switchCategory"
                  data-category="{{item.key}}"
                >
                  <text class="tab-icon">{{item.icon}}</text>
                  <text class="tab-label">{{item.label}}</text>
                </view>
              </block>
            </view>
          </scroll-view>
        </view>

        <!-- å­£èŠ‚ç­›é€‰ -->
        <view class="filter-row">
          <text class="filter-label">å­£èŠ‚</text>
          <scroll-view class="filter-scroll" scroll-x>
            <view class="filter-tabs">
              <block wx:for="{{seasons}}" wx:key="key">
                <view
                  class="filter-tab {{currentSeason === item.key ? 'active' : ''}}"
                  bindtap="switchSeason"
                  data-season="{{item.key}}"
                >
                  <text class="tab-icon">{{item.icon}}</text>
                  <text class="tab-label">{{item.label}}</text>
                </view>
              </block>
            </view>
          </scroll-view>
        </view>

        <!-- æ’åºå’Œæ“ä½œæŒ‰é’® -->
        <view class="action-row">
          <view class="sort-btn" bindtap="showSortMenu">
            <text class="sort-icon">â‡…</text>
            <text class="sort-text">
              {{sortType === 'recent' ? 'æœ€è¿‘æ·»åŠ ' : sortType === 'frequent' ? 'ä½¿ç”¨é¢‘ç‡' : sortType === 'favorite' ? 'å¸¸ç©¿ä¼˜å…ˆ' : 'åç§°æ’åº'}}
            </text>
          </view>
          <view class="action-btns">
            <view class="icon-btn" bindtap="createOutfit">
              <text>ğŸ‘”</text>
            </view>
            <view class="icon-btn primary" bindtap="addClothing">
              <text>â•</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æœè£…ç½‘æ ¼ -->
      <view class="clothing-grid">
        <block wx:for="{{clothingList}}" wx:key="id">
          <view
            class="clothing-card"
            bindtap="viewClothing"
            bindlongpress="onClothingLongPress"
            data-item="{{item}}"
          >
            <!-- å¸¸ç©¿æ ‡è®° -->
            <view wx:if="{{item.isFavorite}}" class="favorite-badge">â­</view>

            <!-- æœè£…å›¾ç‰‡ -->
            <image class="clothing-image" src="{{item.url}}" mode="aspectFill" lazy-load></image>

            <!-- é¢œè‰²æ ‡ç­¾ -->
            <view wx:if="{{item.color}}" class="color-tag">
              <view class="color-dot" style="background: {{item.color === 'black' ? '#000' : item.color === 'white' ? '#fff' : item.color === 'red' ? '#f00' : item.color === 'blue' ? '#06f' : item.color === 'green' ? '#0c6' : item.color === 'yellow' ? '#fd7' : item.color === 'pink' ? '#f69' : item.color === 'gray' ? '#888' : item.color === 'brown' ? '#8b4513' : '#93d'}}; border: {{item.color === 'white' ? '1rpx solid #ddd' : 'none'}};"></view>
            </view>

            <!-- æœè£…ä¿¡æ¯ -->
            <view class="clothing-info">
              <view class="clothing-header">
                <text class="clothing-name">{{item.name || 'æœªå‘½å'}}</text>
                <text class="use-count" wx:if="{{item.useCount > 0}}">Ã—{{item.useCount}}</text>
              </view>
              <view class="clothing-footer">
                <text class="clothing-category">{{item.category === 'top' ? 'ä¸Šè¡£' : item.category === 'bottom' ? 'ä¸‹è£…' : item.category === 'shoes' ? 'é‹å­' : 'å…¶ä»–'}}</text>
                <view class="season-icons">
                  <block wx:if="{{item.seasons && item.seasons.length > 0}}">
                    <text wx:for="{{item.seasons}}" wx:key="*this" wx:if="{{item !== 'all-season'}}" class="season-mini-icon">
                      {{item === 'spring' ? 'ğŸŒ¸' : item === 'summer' ? 'â˜€ï¸' : item === 'autumn' ? 'ğŸ‚' : item === 'winter' ? 'â„ï¸' : 'ğŸŒˆ'}}
                    </text>
                  </block>
                </view>
              </view>
            </view>

            <!-- æ“ä½œæŒ‰é’® -->
            <view class="clothing-actions">
              <view class="action-btn use-btn" catchtap="useClothing" data-item="{{item}}">
                <text>ä½¿ç”¨</text>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </block>

  <!-- å¥—è£…è§†å›¾ -->
  <block wx:if="{{viewMode === 'outfit'}}">
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{outfitList.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ‘”</text>
      <text class="empty-text">è¿˜æ²¡æœ‰å¥—è£…</text>
      <text class="empty-hint">åˆ›å»ºå¥—è£…ï¼Œä¸€é”®è¯•ç©¿å®Œæ•´æ­é…</text>
      <button class="add-btn" bindtap="createOutfit">
        <text class="btn-icon">â•</text>
        <text>åˆ›å»ºå¥—è£…</text>
      </button>
    </view>

    <!-- å¥—è£…åˆ—è¡¨ -->
    <view wx:else class="content-area">
      <view class="outfit-grid">
        <block wx:for="{{outfitList}}" wx:key="id">
          <view class="outfit-card">
            <!-- å¥—è£…é¢„è§ˆå›¾ -->
            <view class="outfit-preview">
              <block wx:for="{{item.items}}" wx:key="id" wx:for-item="clothing">
                <image class="outfit-item-image" src="{{clothing.url}}" mode="aspectFill" lazy-load></image>
              </block>
            </view>

            <!-- å¥—è£…ä¿¡æ¯ -->
            <view class="outfit-info">
              <view class="outfit-header">
                <text class="outfit-name">{{item.name}}</text>
                <text class="use-count" wx:if="{{item.useCount > 0}}">Ã—{{item.useCount}}</text>
              </view>
              <text class="outfit-count">{{item.items.length}}ä»¶å•å“</text>
            </view>

            <!-- æ“ä½œæŒ‰é’® -->
            <view class="outfit-actions">
              <view class="action-btn use-btn" bindtap="useOutfit" data-outfit="{{item}}">
                <text>è¯•ç©¿</text>
              </view>
              <view class="action-btn delete-btn" bindtap="deleteOutfit" data-id="{{item.id}}">
                <text>åˆ é™¤</text>
              </view>
            </view>
          </view>
        </block>
      </view>

      <!-- åˆ›å»ºå¥—è£…æŒ‰é’® -->
      <view class="floating-add-btn" bindtap="createOutfit">
        <text>â•</text>
      </view>
    </view>
  </block>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ’åºèœå•å¼¹çª— -->
  <view wx:if="{{showSortMenu}}" class="modal-mask" bindtap="hideSortMenu">
    <view class="sort-menu" catchtap>
      <view class="menu-title">æ’åºæ–¹å¼</view>
      <view
        class="menu-item {{sortType === 'recent' ? 'active' : ''}}"
        bindtap="switchSort"
        data-sort="recent"
      >
        <text>æœ€è¿‘æ·»åŠ </text>
        <text wx:if="{{sortType === 'recent'}}" class="check-icon">âœ“</text>
      </view>
      <view
        class="menu-item {{sortType === 'frequent' ? 'active' : ''}}"
        bindtap="switchSort"
        data-sort="frequent"
      >
        <text>ä½¿ç”¨é¢‘ç‡</text>
        <text wx:if="{{sortType === 'frequent'}}" class="check-icon">âœ“</text>
      </view>
      <view
        class="menu-item {{sortType === 'favorite' ? 'active' : ''}}"
        bindtap="switchSort"
        data-sort="favorite"
      >
        <text>å¸¸ç©¿ä¼˜å…ˆ</text>
        <text wx:if="{{sortType === 'favorite'}}" class="check-icon">âœ“</text>
      </view>
      <view
        class="menu-item {{sortType === 'name' ? 'active' : ''}}"
        bindtap="switchSort"
        data-sort="name"
      >
        <text>åç§°æ’åº</text>
        <text wx:if="{{sortType === 'name'}}" class="check-icon">âœ“</text>
      </view>
    </view>
  </view>

  <!-- åˆ›å»ºå¥—è£…å¼¹çª— -->
  <view wx:if="{{showOutfitModal}}" class="modal-mask" bindtap="closeOutfitModal">
    <view class="outfit-modal" catchtap>
      <view class="modal-header">
        <text class="modal-title">é€‰æ‹©æœè£…åˆ›å»ºå¥—è£…</text>
        <view class="modal-close" bindtap="closeOutfitModal">Ã—</view>
      </view>

      <scroll-view class="outfit-select-list" scroll-y>
        <block wx:for="{{clothingListForOutfit}}" wx:key="id" wx:for-index="idx">
          <view
            class="outfit-select-item {{item.isSelected ? 'selected' : ''}}"
            bindtap="toggleClothingForOutfit"
            data-item="{{item}}"
            data-index="{{idx}}"
          >
            <image class="select-item-image" src="{{item.url}}" mode="aspectFill" lazy-load></image>
            <view class="select-item-info">
              <text class="select-item-name">{{item.name}}</text>
              <text class="select-item-category">{{item.category === 'top' ? 'ä¸Šè¡£' : item.category === 'bottom' ? 'ä¸‹è£…' : item.category === 'shoes' ? 'é‹å­' : 'å…¶ä»–'}}</text>
            </view>
            <view wx:if="{{item.isSelected}}" class="select-check">âœ“</view>
          </view>
        </block>
      </scroll-view>

      <view class="modal-footer">
        <text class="selected-count">å·²é€‰ {{selectedClothingForOutfit.length}} ä»¶</text>
        <button class="confirm-btn" bindtap="saveOutfit">åˆ›å»ºå¥—è£…</button>
      </view>
    </view>
  </view>
</view>
